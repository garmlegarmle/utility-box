---
interface Props {
  title: string;
  description: string;
  href: string;
  image?: string;
  imageAlt?: string;
  category?: string;
  tag?: string;
  rankLabel?: string;
  meta?: string[];
  ctaLabel?: string;
  contentFile?: string;
}

const {
  title,
  href,
  image,
  imageAlt,
  category,
  tag,
  rankLabel = '#1',
  meta = [],
  contentFile
} = Astro.props;

const categoryText = (category ?? meta[0] ?? 'Category').trim();
const tagText = (tag ?? meta[1] ?? 'Tag').trim();
const rankText = String(rankLabel || '#1').trim() || '#1';
const rankDigits = rankText.replace(/\D/g, '').length;
const titleClass = title.length >= 18 ? 'entry-card__title entry-card__title--compact' : 'entry-card__title';
const rankClass = rankDigits >= 3 || rankText.length >= 4 ? 'entry-card__rank entry-card__rank--compact' : 'entry-card__rank';
---
<article class="entry-card">
  <a class="entry-card__link" href={href}>
    <div class="entry-card__media">
      {image ? (
        <img class="entry-card__image" src={image} alt={imageAlt ?? title} loading="lazy" decoding="async" />
      ) : (
        <div class="entry-card__placeholder">이미지 혹은 숫자</div>
      )}
    </div>
    <div class="entry-card__info">
      <p class="entry-card__meta">
        <span>{categoryText}</span>
        <span>{tagText}</span>
      </p>
      <p class="entry-card__title-row">
        <span class={titleClass}>{title}</span>
        <span class={rankClass}>{rankText}</span>
      </p>
    </div>
  </a>
  {
    contentFile && (
      <button
        type="button"
        class="admin-edit-trigger"
        data-admin-file={contentFile}
        aria-label={`Edit ${title}`}
      >
        +
      </button>
    )
  }
</article>
