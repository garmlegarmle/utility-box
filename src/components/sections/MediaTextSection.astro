---
import { renderSectionMarkdown } from '../../lib/section-markdown';

interface Props {
  mediaEnabled?: boolean;
  src?: string;
  alt?: string;
  body: string;
  mediaPosition?: 'top' | 'left' | 'right';
}

const { mediaEnabled, src, alt, body, mediaPosition = 'top' } = Astro.props;
const html = renderSectionMarkdown(body ?? '');
const showMedia = mediaEnabled !== false && Boolean(src);
const layoutClass = mediaPosition === 'left' ? 'media-left' : mediaPosition === 'right' ? 'media-right' : 'media-top';
const isVideoMedia = Boolean(src && /\.(mp4|webm|ogg)$/i.test(src));
---
<div class={`builder-media-text ${layoutClass}`}>
  {showMedia && (
    <figure class="builder-media-frame ratio-4-3">
      {isVideoMedia ? (
        <video controls playsinline preload="metadata">
          <source src={src} />
          {alt ?? ''}
        </video>
      ) : (
        <img src={src} alt={alt ?? ''} loading="lazy" decoding="async" />
      )}
    </figure>
  )}
  <div class="builder-media-text__body content-prose" set:html={html}></div>
</div>
