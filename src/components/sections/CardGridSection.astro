---
import type { BuilderLink } from '../../lib/section-links';
import { resolveBuilderLink } from '../../lib/section-links';

interface CardGridItem extends BuilderLink {
  title: string;
  description: string;
  imageSrc?: string;
  meta?: string;
}

interface Props {
  title?: string;
  items: CardGridItem[];
  columns?: 2 | 3;
}

const { title, items = [], columns = 3 } = Astro.props;
const colClass = columns === 2 ? 'cols-2' : 'cols-3';
---
<section class="builder-card-grid-wrap">
  {title && <h3>{title}</h3>}
  <div class={`builder-card-grid ${colClass}`}>
    {
      items.map((item) => {
        const link = resolveBuilderLink(item);

        return (
          <article class={`editorial-card${item.imageSrc ? ' has-image' : ''}`}>
            {item.imageSrc && (
              <a class="card-image-wrap" href={link?.href ?? '#'}>
                <img class="card-image" src={item.imageSrc} alt={item.title} loading="lazy" decoding="async" />
              </a>
            )}
            <div class={`card-body${item.imageSrc ? '' : ' text-only'}`}>
              <div>
                <h4 class="card-title">{item.title}</h4>
                <p class="card-description">{item.description}</p>
                {item.meta && <p class="card-meta">{item.meta}</p>}
              </div>
              {
                link && (
                  <a
                    class="text-link"
                    href={link.href}
                    target={link.external && link.openInNewTab ? '_blank' : undefined}
                    rel={link.external && link.openInNewTab ? 'noopener noreferrer' : undefined}
                  >
                    View <span aria-hidden="true">{link.external ? '↗' : '→'}</span>
                    {link.external && <span class="visually-hidden"> (external link)</span>}
                  </a>
                )
              }
            </div>
          </article>
        );
      })
    }
  </div>
</section>
