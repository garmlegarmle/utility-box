---
import EntryCard from '../../components/site/EntryCard.astro';
import { LANGS } from '../../consts';
import HomeLayout from '../../layouts/HomeLayout.astro';
import { buildCollectionPath, getLocalizedCollection, isSupportedLang } from '../../lib/content';

export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as string;
if (!isSupportedLang(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const blogEntries = (await getLocalizedCollection('blog', lang)).slice(0, 8);
const toolEntries = (await getLocalizedCollection('tools', lang)).slice(0, 8);
const gameEntries = (await getLocalizedCollection('games', lang)).slice(0, 8);

const labels = lang === 'ko' ? { blog: 'Blog', tools: 'Tool', games: 'Game' } : { blog: 'Blog', tools: 'Tool', games: 'Game' };
---
<HomeLayout lang={lang} blogTitle={labels.blog} toolsTitle={labels.tools} gamesTitle={labels.games}>
  {blogEntries.map((entry) => (
    <EntryCard
      slot="blog"
      title={entry.data.title}
      description={entry.data.description}
      href={buildCollectionPath(lang, 'blog', entry.data.slug)}
      image={entry.data.cardImage ?? entry.data.image ?? entry.data.heroImage}
      category={entry.data.category}
      tag={entry.data.tags?.[0]}
      contentFile={`src/content/${entry.id}`}
    />
  ))}

  {toolEntries.map((entry) => (
    <EntryCard
      slot="tools"
      title={entry.data.title}
      description={entry.data.description}
      href={buildCollectionPath(lang, 'tools', entry.data.slug)}
      image={entry.data.cardImage ?? entry.data.image ?? entry.data.heroImage}
      category={entry.data.category}
      tag={entry.data.tags?.[0]}
      contentFile={`src/content/${entry.id}`}
    />
  ))}

  {gameEntries.map((entry) => (
    <EntryCard
      slot="games"
      title={entry.data.title}
      description={entry.data.description}
      href={buildCollectionPath(lang, 'games', entry.data.slug)}
      image={entry.data.cardImage ?? entry.data.image ?? entry.data.heroImage}
      category={entry.data.category}
      tag={entry.data.tags?.[0]}
      contentFile={`src/content/${entry.id}`}
    />
  ))}
</HomeLayout>
