---
import BaseLayout from '../../layouts/BaseLayout.astro';
import EntryCard from '../../components/site/EntryCard.astro';
import { LANGS, type SiteLang } from '../../consts';
import { buildCollectionPath, getLocalizedCollection } from '../../lib/content';

export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as SiteLang;
if (!LANGS.includes(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const otherLang: SiteLang = lang === 'en' ? 'ko' : 'en';
const tools = (await getLocalizedCollection('tools', lang)).slice(0, 3);
const games = (await getLocalizedCollection('games', lang)).slice(0, 3);
const posts = (await getLocalizedCollection('blog', lang)).slice(0, 3);

const strings =
  lang === 'ko'
    ? {
        title: '실용적인 도구, 게임, 가이드를 한곳에서',
        description: 'Utility Box는 운영자가 코드 없이 콘텐츠를 편집하고, 필요 시 기능은 코드로 확장할 수 있는 다국어 플랫폼입니다.',
        quick: '바로가기',
        tools: '도구',
        games: '게임',
        blog: '블로그',
        latestTools: '최신 도구',
        latestGames: '최신 게임',
        latestPosts: '최신 글'
      }
    : {
        title: 'Practical tools, games, and guides in one multilingual platform',
        description: 'Utility Box lets operators edit content in a CMS while Codex can still ship code-driven features when needed.',
        quick: 'Quick links',
        tools: 'Tools',
        games: 'Games',
        blog: 'Blog',
        latestTools: 'Latest tools',
        latestGames: 'Latest games',
        latestPosts: 'Latest posts'
      };
---
<BaseLayout
  title={lang === 'ko' ? '홈' : 'Home'}
  description={strings.description}
  lang={lang}
  activeNav="home"
  languageToggleHref={`/${otherLang}/`}
  canonicalPath={`/${lang}/`}
  alternates={[
    { lang: 'en', href: '/en/' },
    { lang: 'ko', href: '/ko/' }
  ]}
>
  <section class="section">
    <div class="container home-columns">
      <div class="lead-copy">
        <h1>{strings.title}</h1>
        <p>{strings.description}</p>
      </div>
      <aside class="quick-links" aria-label={strings.quick}>
        <h2>{strings.quick}</h2>
        <ul>
          <li><a class="text-link" href={`/${lang}/tools/`}>{strings.tools} →</a></li>
          <li><a class="text-link" href={`/${lang}/games/`}>{strings.games} →</a></li>
          <li><a class="text-link" href={`/${lang}/blog/`}>{strings.blog} →</a></li>
        </ul>
      </aside>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="page-head">
        <h2>{strings.latestTools}</h2>
      </div>
      <div class="grid editorial-grid">
        {
          tools.map((entry) => (
            <EntryCard
              title={entry.data.title}
              description={entry.data.description}
              href={buildCollectionPath(lang, 'tools', entry.data.slug)}
              image={entry.data.cardImage}
              meta={[entry.data.category ?? '', ...(entry.data.tags ?? []).slice(0, 2)].filter(Boolean)}
              ctaLabel={lang === 'ko' ? '열기' : 'Open'}
            />
          ))
        }
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="page-head">
        <h2>{strings.latestGames}</h2>
      </div>
      <div class="grid editorial-grid">
        {
          games.map((entry) => (
            <EntryCard
              title={entry.data.title}
              description={entry.data.description}
              href={buildCollectionPath(lang, 'games', entry.data.slug)}
              image={entry.data.cardImage}
              meta={[entry.data.category ?? '', ...(entry.data.tags ?? []).slice(0, 2)].filter(Boolean)}
              ctaLabel={lang === 'ko' ? '열기' : 'Open'}
            />
          ))
        }
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="page-head">
        <h2>{strings.latestPosts}</h2>
      </div>
      <div class="grid editorial-grid">
        {
          posts.map((entry) => (
            <EntryCard
              title={entry.data.title}
              description={entry.data.description}
              href={buildCollectionPath(lang, 'blog', entry.data.slug)}
              image={entry.data.cardImage}
              meta={[entry.data.category ?? '', ...(entry.data.tags ?? []).slice(0, 2)].filter(Boolean)}
              ctaLabel={lang === 'ko' ? '읽기' : 'Read'}
            />
          ))
        }
      </div>
    </div>
  </section>
</BaseLayout>
