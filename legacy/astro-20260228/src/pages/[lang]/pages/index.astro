---
import EntryCard from '../../../components/site/EntryCard.astro';
import { LANGS } from '../../../consts';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { buildCollectionPath, getLocalizedCollection, getOtherLang, isSupportedLang } from '../../../lib/content';

export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}

const lang = Astro.params.lang as string;
if (!isSupportedLang(lang)) {
  throw new Error('Invalid route params');
}

const entries = await getLocalizedCollection('pages', lang);
const otherLang = getOtherLang(lang);
const tags = [...new Set(entries.flatMap((entry) => entry.data.tags ?? []))].slice(0, 8);
const tagLine = tags.length > 0 ? `tag list ${tags.join(' Â· ')}` : 'tag list';
---
<BaseLayout
  title="Page"
  description="Generic pages"
  lang={lang}
  languageToggleHref={`/${otherLang}/pages/`}
  canonicalPath={`/${lang}/pages/`}
  alternates={[
    { lang: 'en', href: '/en/pages/' },
    { lang: 'ko', href: '/ko/pages/' }
  ]}
>
  <section class="page-section">
    <div class="container">
      <header class="list-head">
        <h1>Page</h1>
        <p class="list-tags">{tagLine}</p>
      </header>
      <div class="listing-grid listing-grid--four">
        {
          entries.map((entry) => (
            <EntryCard
              title={entry.data.title}
              description={entry.data.description}
              href={buildCollectionPath(lang, 'pages', entry.data.slug)}
              image={entry.data.cardImage ?? entry.data.image ?? entry.data.heroImage}
              category={entry.data.category}
              tag={entry.data.tags?.[0]}
              contentFile={`src/content/${entry.id}`}
            />
          ))
        }
      </div>
    </div>
  </section>
</BaseLayout>
